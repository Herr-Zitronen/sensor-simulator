<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Sensor Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/mqttws31.min.js"></script>
</head>

<body>
    <h1>Datos del Sensor</h1>
    <pre id="output">Esperando datos del sensor...</pre>

    <script>
        const broker = "test.mosquitto.org";
        const port = 8081;  // WebSocket sin TLS
        const clientId = "web_" + Math.random().toString(16).substr(2, 8);
        const topic = "sensor/temperature";

        const client = new Paho.MQTT.Client(broker, port, clientId);

        client.onConnectionLost = function (responseObject) {
            console.log("ConexiÃ³n perdida:", responseObject.errorMessage);
        };

        client.onMessageArrived = function (message) {
            console.log("Mensaje recibido:", message.payloadString);
            document.getElementById("output").textContent = message.payloadString;
        };

        client.connect({
            onSuccess: () => {
                console.log("Conectado al broker MQTT");
                client.subscribe(topic);
            },
            useSSL: false
        });
    </script>
</body>

</html>